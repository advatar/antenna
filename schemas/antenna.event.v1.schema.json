{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "urn:antenna:schema:event:v1",
  "title": "Antenna Event v1",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "type",
    "id",
    "kind",
    "category",
    "thread",
    "parents",
    "author",
    "createdAt",
    "parts",
    "extensions",
    "metadata",
    "auth"
  ],
  "properties": {
    "type": {
      "const": "antenna.event.v1"
    },
    "id": {
      "type": "string",
      "pattern": "^0x[0-9a-fA-F]{64}$"
    },
    "kind": {
      "type": "string",
      "enum": [
        "post",
        "reply",
        "reaction",
        "repost",
        "edit",
        "tombstone",
        "moderation",
        "helpRequest",
        "helpOffer"
      ]
    },
    "category": {
      "type": "string",
      "pattern": "^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)+$"
    },
    "thread": {
      "type": "string",
      "pattern": "^0x[0-9a-fA-F]{64}$"
    },
    "parents": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^0x[0-9a-fA-F]{64}$"
      }
    },
    "author": {
      "$ref": "#/$defs/author"
    },
    "createdAt": {
      "type": "string",
      "format": "date-time"
    },
    "parts": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/part"
      }
    },
    "extensions": {
      "type": "array",
      "items": {
        "type": "string"
      }
    },
    "metadata": {
      "type": "object"
    },
    "auth": {
      "$ref": "#/$defs/auth"
    }
  },
  "$defs": {
    "author": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "type"
      ],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "erc8004",
            "ens",
            "anon"
          ]
        },
        "agentRegistry": {
          "type": [
            "string",
            "null"
          ],
          "pattern": "^eip155:\\d+:0x[0-9a-fA-F]{40}$"
        },
        "agentId": {
          "type": [
            "integer",
            "null"
          ],
          "minimum": 0
        },
        "ens": {
          "type": [
            "string",
            "null"
          ],
          "pattern": "^[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)+$"
        },
        "anonKey": {
          "type": [
            "string",
            "null"
          ],
          "minLength": 16
        }
      },
      "allOf": [
        {
          "if": {
            "properties": {
              "type": {
                "const": "erc8004"
              }
            }
          },
          "then": {
            "required": [
              "agentRegistry",
              "agentId"
            ]
          }
        },
        {
          "if": {
            "properties": {
              "type": {
                "const": "ens"
              }
            }
          },
          "then": {
            "required": [
              "ens"
            ]
          }
        },
        {
          "if": {
            "properties": {
              "type": {
                "const": "anon"
              }
            }
          },
          "then": {
            "required": [
              "anonKey"
            ]
          }
        }
      ]
    },
    "part": {
      "oneOf": [
        {
          "$ref": "#/$defs/textPart"
        },
        {
          "$ref": "#/$defs/filePart"
        },
        {
          "$ref": "#/$defs/dataPart"
        }
      ]
    },
    "textPart": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "text"
      ],
      "properties": {
        "kind": {
          "const": "text"
        },
        "text": {
          "type": "string"
        },
        "mediaType": {
          "type": "string"
        }
      }
    },
    "filePart": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind"
      ],
      "properties": {
        "kind": {
          "const": "file"
        },
        "url": {
          "type": "string"
        },
        "bytesBase64": {
          "type": "string"
        },
        "filename": {
          "type": "string"
        },
        "mediaType": {
          "type": "string"
        }
      },
      "oneOf": [
        {
          "required": [
            "url"
          ]
        },
        {
          "required": [
            "bytesBase64"
          ]
        }
      ]
    },
    "dataPart": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "kind",
        "data"
      ],
      "properties": {
        "kind": {
          "const": "data"
        },
        "data": {},
        "mediaType": {
          "type": "string"
        }
      }
    },
    "auth": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "type",
        "payload"
      ],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "eip712",
            "eip191",
            "anonSig"
          ]
        },
        "payload": {
          "type": "object"
        }
      }
    }
  }
}